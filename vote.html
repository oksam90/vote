<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Syst√®me de Vote Dynamique</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f9f9f9; }
    .candidate-card img { width:100%; height:200px; object-fit:cover; }
    .winner-badge { font-size:1.2rem; font-weight:bold; color:#fff; background:#198754; padding:8px 15px; border-radius:8px; }
    #endMessage { font-weight:bold; color:red; margin-top:10px; }
  </style>
</head>
<body class="container py-4">

  <h1 class="text-center mb-4">Vote en direct üó≥Ô∏è</h1>

  <!-- Timer -->
  <div class="text-center mb-3">
    <h4>Temps restant : <span id="timer" class="text-danger">08:00:00</span></h4>
    <div id="endMessage" style="display:none;">‚õî Les votes sont clos !</div>
  </div>

  <!-- Candidats -->
  <div class="row g-4" id="cardsRow"></div>

  <!-- R√©sultats -->
  <div class="mt-5">
    <h2>R√©sultats</h2>
    <p>Total des votes : <strong id="totalVotes">0</strong></p>
    <div id="winnerBadge" class="winner-badge mb-3" style="display:none;">
      üèÜ Vainqueur : <span id="winnerName"></span>
    </div>

    <!-- Progress bars -->
    <div id="progressList" class="mb-4"></div>

    <!-- Tableau -->
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Candidat</th>
            <th>Votes</th>
            <th>%</th>
          </tr>
        </thead>
        <tbody id="resultsTable"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Dur√©e du vote en secondes (8 heures = 28800)
    const VOTE_DURATION = 28800;

    // Candidats
    const candidates = [
      { id:"c1", name:"Mamdou & Amy",    color:"primary", img:"amy & mamadou.png" },
      { id:"c2", name:"Joseph & Sana",   color:"danger",  img:"J&S.jpg" },
      { id:"c3", name:"Coll√®ge Employe", color:"warning", img:"coll√®ge employ√©.png" },
      { id:"c4", name:"Barry",           color:"success", img:"barry.png" }
    ];

    let votes = Object.fromEntries(candidates.map(c=>[c.id,0]));
    let votingOpen = true;

    function totalVotes(){ return Object.values(votes).reduce((a,b)=>a+b,0); }
    function percent(v,t){ return t?Math.round((v*10000)/t)/100:0; }

    // G√©n√©rer les cartes candidats
    function renderCards(){
      const row=document.getElementById("cardsRow");
      row.innerHTML="";
      candidates.forEach(c=>{
        row.innerHTML+=`
          <div class="col-12 col-md-6 col-lg-3">
            <div class="card candidate-card h-100 position-relative" id="card-${c.id}">
              <img src="${c.img}" alt="${c.name}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title mb-1">${c.name}</h5>
                <p class="card-text small mb-3">Voix : <strong id="count-${c.id}">${votes[c.id]}</strong></p>
                <div class="mt-auto d-grid">
                  <button id="btn-${c.id}" class="btn btn-${c.color}" onclick="vote('${c.id}')">Voter</button>
                </div>
              </div>
            </div>
          </div>`;
      });
    }

    // G√©n√©rer les r√©sultats
    function renderResults(){
      const total=totalVotes();
      document.getElementById("totalVotes").textContent=total;
      const ranked=[...candidates].map(c=>({...c,votes:votes[c.id]})).sort((a,b)=>b.votes-a.votes);

      // Graphique barres
      document.getElementById("progressList").innerHTML="";
      ranked.forEach(c=>{
        const p=percent(c.votes,total);
        document.getElementById("progressList").innerHTML+=`
          <div class="d-flex justify-content-between">
            <span>${c.name}</span><small>${c.votes} voix ‚Ä¢ ${p}%</small>
          </div>
          <div class="progress">
            <div class="progress-bar bg-${c.color}" style="width:${p}%">${p}%</div>
          </div>`;
      });

      // Tableau
      const tbody=document.getElementById("resultsTable");
      tbody.innerHTML="";
      ranked.forEach((c,i)=>{
        tbody.innerHTML+=`<tr>
          <td>${i+1}</td><td>${c.name}</td>
          <td class="text-end">${c.votes}</td>
          <td class="text-end">${percent(c.votes,total)}%</td>
        </tr>`;
      });

      // Vainqueur
      const winnerBadge=document.getElementById("winnerBadge");
      if(ranked[0].votes>0){
        winnerBadge.style.display="";
        document.getElementById("winnerName").textContent=ranked[0].name;
      } else {
        winnerBadge.style.display="none";
      }

      // Update compteurs sur cartes
      candidates.forEach(c=>{
        document.getElementById("count-"+c.id).textContent=votes[c.id];
      });
    }

    // Fonction vote
    function vote(id){
      if(!votingOpen) return;
      votes[id]++;
      renderResults();
    }
    window.vote=vote;

    // Timer
    let timeLeft=VOTE_DURATION;
    const timerEl=document.getElementById("timer");
    function updateTimer(){
      const hrs=Math.floor(timeLeft/3600).toString().padStart(2,"0");
      const min=Math.floor((timeLeft%3600)/60).toString().padStart(2,"0");
      const sec=(timeLeft%60).toString().padStart(2,"0");
      timerEl.textContent=`${hrs}:${min}:${sec}`;
      if(timeLeft<=0){
        votingOpen=false;
        document.querySelectorAll("button[id^='btn-']").forEach(btn=>btn.disabled=true);
        timerEl.textContent="00:00:00";
        clearInterval(timerInterval);
        document.getElementById("endMessage").style.display="block";
      }
      timeLeft--;
    }
    const timerInterval=setInterval(updateTimer,1000);
    updateTimer();

    // Initialisation
    renderCards();
    renderResults();
  </script>
</body>
</html>
